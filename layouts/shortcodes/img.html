<figure{{ if .Get "class" }} class="{{ .Get "class" }}"{{ end }}>
  {{- $srcPath := .Get "src" -}}
  
  <amp-img {{ if hasPrefix $srcPath "http" -}}
      src="{{ $srcPath }}"
    {{ else if hasPrefix $srcPath "/images" }}
      src="{{ $srcPath }}"
    {{ else }}
      src="/{{$.Page.Dir}}images/{{ $srcPath }}"
    {{- end }}
      alt="{{ .Get "caption" }}" {{ with (.Get "w") }} width="{{ . }}"{{ end }} {{ with (.Get "h") }} height="{{ . }}"{{ end }}
      > </amp-img>

  {{ if .Get "caption" }}
  <figcaption>
    {{ if .Get "href" }}
    <a href="{{ .Get "href" }}" target="_blank">{{ .Get "caption" }}</a>
    {{ else }}
    {{ .Get "caption" }}
    {{ end }}
  </figcaption>
  {{ end }}
</figure>
